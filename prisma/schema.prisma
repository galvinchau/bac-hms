// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"   // Dùng PostgreSQL (Supabase)
  url      = env("DATABASE_URL")
}

/*
  Individual = hồ sơ bệnh nhân/khách hàng
  code      = mã hiển thị: IND-2025-000001
*/
model Individual {
  id            String   @id @default(cuid())   // khoá kỹ thuật
  code          String   @unique               // mã hiển thị, sẽ sinh từ Counter

  firstName     String
  middleName    String?
  lastName      String
  dob           String   // YYYY-MM-DD
  gender        String?
  ssnLast4      String?  // chỉ 4 số

  branch        String
  location      String

  primaryPhone   String?
  secondaryPhone String?
  email          String?

  address1 String?
  address2 String?
  city     String?
  county   String?
  state    String?
  zip      String?

  // acceptedServices: form gửi lên là mảng string, DB lưu dạng CSV cho đơn giản
  acceptedServices String

  // Emergency contacts
  emergency1Name           String?
  emergency1Relationship   String?
  emergency1PhonePrimary   String?
  emergency1PhoneSecondary String?
  emergency1Notes          String?

  emergency2Name           String?
  emergency2Relationship   String?
  emergency2PhonePrimary   String?
  emergency2PhoneSecondary String?
  emergency2Notes          String?

  // Billing / guardian
  billingSameAsPrimary Boolean @default(true)
  billingAddress1      String?
  billingAddress2      String?
  billingCity          String?
  billingState         String?
  billingZip           String?

  guardianName  String?
  guardianPhone String?
  repPayeeName  String?
  repPayeePhone String?

  // Clinical
  pcpName    String?
  pcpPhone   String?
  pcpFax     String?
  pcpNpi     String?
  pcpAddress String?
  allergies  String?

  // Preparedness / equipment
  priorityCode String?
  mobility     String?
  equipOxygen        Boolean @default(false)
  equip_cpap         Boolean @default(false)
  equip_ventilator   Boolean @default(false)
  equip_iv_pump      Boolean @default(false)
  equip_syringe_pump Boolean @default(false)
  equip_feeding_tube Boolean @default(false)
  equip_nebulizer    Boolean @default(false)
  equip_wheelchair   Boolean @default(false)
  equip_hospital_bed Boolean @default(false)
  equipOther         String?

  // Preferences
  prefTime        String?
  prefNotes       String?
  langPrimary     String?
  langSecondary   String?
  caregiverGender String?
  prefOther       String?

  // Advanced directives
  advType      String?
  advDateIn    String?
  advDateOut   String?
  advStatus    String?
  advPhysician String?
  advAttach    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  payers      Payer[]
  medications Medication[]
  diagnoses   Diagnosis[]
}

/*
  Employee = hồ sơ nhân viên Blue Angels Care
  employeeId = mã hiển thị: BAC-E-2025-001 (nhập từ form, sau này có thể sinh tự động bằng Counter)
*/
model Employee {
  id String @id @default(cuid())   // khoá kỹ thuật

  // Demographics
  firstName  String
  middleName String?
  lastName   String
  dob        String?  // YYYY-MM-DD
  gender     String?
  phone      String?
  email      String

  educationLevel String? // trình độ học vấn/chuyên môn
  ssn           String?  // 9 digits

  // Employment Info
  employeeId      String  @unique // BAC-E-2025-001
  role            String?         // DSP / Nurse / Supervisor / ...
  status          String?         // Active / On Leave / Inactive
  hireDate        String?         // YYYY-MM-DD
  terminationDate String?         // YYYY-MM-DD
  employmentType  String?         // Full-time / Part-time / Per-diem / Contract
  branch          String?         // Altoona / Hollidaysburg / ...
  workLocation    String?         // mô tả chi tiết hơn location
  supervisorName  String?         // tên supervisor trực tiếp

  // Address
  address1 String?
  address2 String?
  city     String?
  state    String?
  zip      String?

  // Emergency Contact
  emergencyName              String?
  emergencyRelationship      String?
  emergencyPhone             String?
  emergencyEmail             String?
  emergencyPreferredLanguage String?
  emergencyAddress           String?

  // Work Preferences
  preferredShift  String?   // Morning / Afternoon / Evening / Overnight
  canWorkWeekends Boolean @default(false)
  canWorkHolidays Boolean @default(false)
  maxWeeklyHours  Int?
  notes           String?

  // Notification Preferences
  notifyByEmail       Boolean @default(true)
  notifyBySMS         Boolean @default(false)
  notifyByInApp       Boolean @default(true)
  sendScheduleChanges Boolean @default(true)
  sendPayrollUpdates  Boolean @default(true)
  sendPolicyUpdates   Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/*
  Payer: các đối tượng thanh toán: Primary / Secondary
*/
model Payer {
  id          String @id @default(cuid())
  type        String        // "Primary" | "Secondary"
  name        String
  plan        String?
  memberId    String
  groupId     String?
  startDate   String?
  endDate     String?
  eligibility String?       // Verified | Pending | Not Eligible
  notes       String?

  individualId String
  individual   Individual @relation(fields: [individualId], references: [id], onDelete: Cascade)
}

/*
  Medications
*/
model Medication {
  id       String @id @default(cuid())
  name     String
  dose     String?
  schedule String?

  individualId String
  individual   Individual @relation(fields: [individualId], references: [id], onDelete: Cascade)
}

/*
  Diagnoses (ICD)
*/
model Diagnosis {
  id          String @id @default(cuid())
  icd         String
  description String?
  onset       String? // YYYY-MM-DD

  individualId String
  individual   Individual @relation(fields: [individualId], references: [id], onDelete: Cascade)
}

/*
  Counter dùng để sinh code: IND-2025-000001, IND-2025-000002, ...
  (sau này có thể xài chung cho Employee, ví dụ id = "EMP-2025")
*/
model Counter {
  id    String @id   // ví dụ: "IND-2025"
  value Int
}

/*
  Service = danh mục dịch vụ (dùng cho Accepted Services + scheduling + billing)
*/
model Service {
  id          String   @id @default(cuid())   // technical id

  // Short code dùng chung với Accepted Services (PCA, NT, PBIS...)
  serviceCode String   @unique               // e.g. "PCA"

  // Tên đầy đủ: "Personal Care Assistant"
  serviceName String

  // Mã billing / code show cho payer (SVC-001, T1019...)
  billingCode String?

  // "None-Residential" | "Residential service"
  category    String

  // Mô tả dịch vụ
  description String?

  // "Active" | "Inactive"
  status      String

  // Có dùng để claim/billing không
  billable    Boolean  @default(true)

  // Ghi chú nội bộ
  notes       String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
